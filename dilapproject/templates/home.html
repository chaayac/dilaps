<!DOCTYPE html>

<html lang="en">
	<head>

		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>ACE - Dilapidation Reporting</title>

		{% load staticfiles %}

		<link rel="stylesheet" href="{% static 'dilapjobs/css/bootstrap.min.css' %}" />
		<link rel="stylesheet" href="{% static 'dilapjobs/css/bootstrap-theme.min.css' %}" />
		<link rel="stylesheet" href="{% static 'dilapjobs/css/carousel.css' %}" />
		<link rel="stylesheet" href="{% static 'dilapjobs/css/signin.css' %}" />
		<link rel="stylesheet" href="{% static 'dilapjobs/css/bootstrap.min.css' %}" />
		<link rel="stylesheet" href="{% static 'dilapjobs/css/bootstrap-theme.css' %}" />

	</head>
	<!-- end header -->	
	<body style="background-color: white">
		<div class="container" style="background-color: rgba(255,255,255,0.8)">
			<center style="padding-top: 0px">
				<img src="https://media.licdn.com/mpr/mpr/shrink_100_100/AAEAAQAAAAAAAALuAAAAJGY3M2Y5OTk4LTZlMDYtNDFjMy05NTJmLTQwNmYzNWQyM2I3MQ.png">
				<p style="font-size: 20px"><b>A</b>ustralian <b>C</b>onsulting <b>E</b>ngineers</p>
			</center>
			<center style="padding-bottom: 15px">Dilapidation Department</center>
			<form class="form-inline" method="POST" style="padding-bottom: 20px">
				{% csrf_token %}
		        <input type="text" name="search_val" class="form-control" style="width:93%" placeholder="Search for anything..." autofocus>
		        <input type="submit" name="search_btn" class="btn" style="float:right; background-color: black; color: white" value="Search">
		    </form>
			<button class="btn btn-info" style="width: 100%" data-toggle="collapse" data-target="#createjobformdiv">Create Job &#9660;</button>
			<div class="span4 collapse" id="createjobformdiv">
				<form class="form-inline" style="padding-bottom: 20px" method="POST">     
					{% csrf_token %}   
			      	<input type="text" name="jobnumber" style="width: 100%"class="form-control" placeholder="######" required autofocus></td>
			      	<input type="text" name="client" style="width: 100%" class="form-control" placeholder="Customer Name" required autofocus></td>
			        <input type="text" name="address" style="width: 100%" class="form-control" placeholder="Address" required></td>
					<input type="text" name="councilassets" style="width: 100%" class="form-control" placeholder="Enter Council Assets seperated by a semicolon (';')"></td>
			       	<input type="text" name="neighbours" style="width: 100%" class="form-control" placeholder="Enter Neighbouring Properties seperated by a semicolon (';')"></td>
			       	<input type="text" name="letters" style="width: 100%" class="form-control" placeholder="Letters"></td>        
			       	<input type="text" name="notes" style="width: 100%" class="form-control" placeholder="Some notes on the job..."></td>
			       	<input type="submit" name="createjob" style="width: 100%" class="btn btn-primary" value="Add Job"></td>
			    </form>
		    </div>
			
			<table class="table" style="table-layout: fixed; margin: 0; padding-top: 20px">
			    <col width="9" />
			    <col width="22" />
			    <col width="22" />
			    <col width="44" />
			    <thead>
					<tr>
						<th>Job</th>
						<th>Customer</th>
						<th>Address</th>
						<th>Notes</th>
					</tr>
			    </thead>
		    </table>
<!-- this part needs to be repeatable -->
			{% for j in jobs %}
			<table class="table" style="table-layout:fixed; margin: 0">
			    <col width="9" />
			    <col width="22" />
			    <col width="22" />
			    <col width="44" />
			    {% if j.status == "Complete" %}
					<tr data-toggle="collapse" data-target="#viewdetails{{j.jobnumber}}" style="background-color: green">
				{% else %}
					<tr data-toggle="collapse" data-target="#viewdetails{{j.jobnumber}}">
				{% endif %}
			        <td>
			        <form method="POST" style="form-inline">
			        	{% csrf_token %}        
						<div class="dropdown">
  							<button class="btn dropdown-toggle" style="background-color: Transparent; padding: 0; margin: 0" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    						<span class="caret"></span>
  							<b>{{j.jobnumber}}</b></button>
						  	<ul class="dropdown-menu" style="min-width: 0" aria-labelledby="dropdownMenu1">
						  		<input type="hidden" name="change" class="form-control" value="{{ j.jobnumber }}">
							    <li><a><input type="submit" class="btn" style="background-color: Transparent" name="edit_job" value="Edit"></a></li>
							    <li><a><input type="submit" class="btn" style="background-color: Transparent" name="delete_job" value="Delete"></a></li>
								<li><a><input type="submit" class="btn" style="background-color: Transparent" name="complete_job" value="Complete"></a></li>
						  	</ul>
						</div>	
					</form>
			        </td>
			        <td>{{j.client}}</td>
			        <td>
			        	{% if j.latitude %}
			        		<a target="_blank" href="http://maps.googleapis.com/maps/api/staticmap?center={{ j.latitude }},{{ j.longitude }}&size=600x600&zoom=18&sensor=false&maptype=satellite">{{j.address}} {{j.postcode}}</a>
			        	{% else %}
			        		{{ j.address }}
			        	{% endif %}
			        </td>
			        <td>{{j.notes}}</td> 
			    </tr>
		    </table>

		    <div class="container">
			    <div class="span4 collapse-group">
			        <div class="collapse" style="margin:0" id="viewdetails{{j.jobnumber}}">
			        	<table class="table" id="tableX">
				        	<col width="33" />
				    		<col width="33" />
				    		<col width="33" />
							<p><span style="float:left"><i>Created: {{j.timestamp}}</i></span></p>
							<thead>
								<th>Council Assets</th>
								<th>Neighbouring Properties</th>
								<th>Letters</th>
							</thead>
			        		<tr>
						        <td>{{j.councilassets}}</td>
							    <td>{{j.neighbours}}</td>
								<td>{{j.letters}}</td>
							</tr>
						</table>
			    	</div>
			    </div>
		    </div>
		    {% endfor %}
<!-- end repeatable part -->

		</div> <!-- /container -->
	</body>

	<!-- Bootstrap core JavaScript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js'></script>
	<script src="{% static 'dilapjobs/js/bootstrap.min.js' %}"></script>
	<script>
		$('.row .btn').on('click', function(e) {
	    e.preventDefault();
	    var $this = $(this);
	    var $collapse = $this.closest('.collapse-group').find('.collapse');
	    $collapse.collapse('toggle');
		});
		
		$("tableX").each(function() {
	        var $this = $(this);
	        var newrows = [];

	        $this.find("tr").each(function(){
	            var i = 0;

	            $(this).find("td").each(function(){
	                i++;
	                if(newrows[i] === undefined) { newrows[i] = $(""); }
	                newrows[i].append($(this));
	            });
	        });

	        $this.find("tr").remove();
	        $.each(newrows, function(){
	            $this.append(this);
	        });
	    });
	</script>
</html>